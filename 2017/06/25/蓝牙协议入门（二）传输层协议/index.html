<!DOCTYPE html>
<html>
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
  
  <title>蓝牙协议入门（二）传输层协议 - Jackie</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1.传输层协议 传输层位于蓝牙系统的底层，负责蓝牙设备间，互相确认对方的位置，以及建立和管理蓝牙设备间的物理链路。其又分为射频层、基带层和链路管理层三部分。 2.射频层协议2.1.工作频率蓝牙工作在 2.4 GHz ISM 频段上，蓝牙采用跳频扩谱技术主动的避免工作频段受干扰。我国的蓝牙频率在 2.402 GHz～2.483 GHz,蓝牙每个频道的宽度为1 MHz，为了减少带外辐射的干扰，保留上、">
<meta name="keywords" content="蓝牙">
<meta property="og:type" content="article">
<meta property="og:title" content="蓝牙协议入门（二）传输层协议">
<meta property="og:url" content="http://yoursite.com/2017/06/25/蓝牙协议入门（二）传输层协议/index.html">
<meta property="og:site_name" content="Jackie">
<meta property="og:description" content="1.传输层协议 传输层位于蓝牙系统的底层，负责蓝牙设备间，互相确认对方的位置，以及建立和管理蓝牙设备间的物理链路。其又分为射频层、基带层和链路管理层三部分。 2.射频层协议2.1.工作频率蓝牙工作在 2.4 GHz ISM 频段上，蓝牙采用跳频扩谱技术主动的避免工作频段受干扰。我国的蓝牙频率在 2.402 GHz～2.483 GHz,蓝牙每个频道的宽度为1 MHz，为了减少带外辐射的干扰，保留上、">
<meta property="og:image" content="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270002.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270004.png">
<meta property="og:image" content="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270005.png">
<meta property="og:updated_time" content="2017-07-28T12:28:42.978Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="蓝牙协议入门（二）传输层协议">
<meta name="twitter:description" content="1.传输层协议 传输层位于蓝牙系统的底层，负责蓝牙设备间，互相确认对方的位置，以及建立和管理蓝牙设备间的物理链路。其又分为射频层、基带层和链路管理层三部分。 2.射频层协议2.1.工作频率蓝牙工作在 2.4 GHz ISM 频段上，蓝牙采用跳频扩谱技术主动的避免工作频段受干扰。我国的蓝牙频率在 2.402 GHz～2.483 GHz,蓝牙每个频道的宽度为1 MHz，为了减少带外辐射的干扰，保留上、">
<meta name="twitter:image" content="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270002.png">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  

</head>

<body>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo" href="/"></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-蓝牙协议入门（二）传输层协议" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      蓝牙协议入门（二）传输层协议
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2017/06/25/蓝牙协议入门（二）传输层协议/" class="article-date">
  <time datetime="2017-06-25T03:38:37.000Z" itemprop="datePublished">2017-06-25</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/技术/">技术</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="1-传输层协议"><a href="#1-传输层协议" class="headerlink" title="1.传输层协议"></a>1.传输层协议</h2><p><img src="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270002.png" alt=""></p>
<p>传输层位于蓝牙系统的底层，负责蓝牙设备间，互相确认对方的位置，以及建立和管理蓝牙设备间的物理链路。其又分为射频层、基带层和链路管理层三部分。</p>
<h2 id="2-射频层协议"><a href="#2-射频层协议" class="headerlink" title="2.射频层协议"></a>2.射频层协议</h2><h3 id="2-1-工作频率"><a href="#2-1-工作频率" class="headerlink" title="2.1.工作频率"></a>2.1.工作频率</h3><p>蓝牙工作在 <strong>2.4 GHz ISM</strong> 频段上，蓝牙采用跳频扩谱技术主动的避免工作频段受干扰。我国的蓝牙频率在 <strong>2.402 GHz～2.483 GHz</strong>,蓝牙每个频道的宽度为<strong>1 MHz</strong>，为了减少带外辐射的干扰，保留上、下保护为<strong>3.5 MHz</strong> 和 <strong>2 MHz</strong>，<strong>79</strong> 个跳频点中至少 <strong>75</strong> 个伪随机码跳动，<strong>30 s</strong> 内任何一个频点使用时长不能超过 <strong>0.4 s</strong>。</p>
<table>
<thead>
<tr>
<th>地理位置</th>
<th>ISM频段范围</th>
<th>射频信道频率</th>
</tr>
</thead>
<tbody>
<tr>
<td>中国、美国、欧洲</td>
<td>2400.0～2483.5MHz</td>
<td>F=(2402+k)MHz,k在0、1、……78中随机取值</td>
</tr>
<tr>
<td>法国</td>
<td>2446.5～2483.5MHz</td>
<td>F=(2454+k)MHz,k在0、1、……22中随机取值</td>
</tr>
<tr>
<td>日本</td>
<td>2471.0～2497.0MHz</td>
<td>F=(2473+k)MHz,k在0、1、……22中随机取值</td>
</tr>
<tr>
<td>西班牙</td>
<td>2445.0～2475.0MHz</td>
<td>F=(2449+k)MHz,k在0、1、……22中随机取值</td>
</tr>
</tbody>
</table>
<h3 id="2-2-跳频技术、发射功率、时隙"><a href="#2-2-跳频技术、发射功率、时隙" class="headerlink" title="2.2.跳频技术、发射功率、时隙"></a>2.2.跳频技术、发射功率、时隙</h3><ul>
<li>发射功率：蓝牙发射功率分三级：一级功率<strong>100 mW</strong>( <strong>20 dBm</strong>)；二级功率 <strong>2.5 mW</strong>( <strong>4 dBm</strong>)；三级功率<strong>1 mW</strong>( <strong>0 dBm</strong>)；</li>
<li>物理信道：蓝牙物理信道有伪随机序列控制的 <strong>79</strong> 个跳频点构成，不同跳频序列代表不同的信道。</li>
<li>时隙：蓝牙跳频速率为<strong>1600</strong> 次/<strong>s</strong>,每个时间为 <strong>625 us</strong> (<strong>1 s/1600</strong>) 称为一个时隙；</li>
</ul>
<h2 id="3-基带层协议"><a href="#3-基带层协议" class="headerlink" title="3.基带层协议"></a>3.基带层协议</h2><p>蓝牙发送数据时，基带部分将来自高层的数据进行信道编码，向下发给射频进行发送；接收数据时，将解调恢复空中数据并上传给基带，基带进行信道编码传送给上层。</p>
<h3 id="3-1-蓝牙地址"><a href="#3-1-蓝牙地址" class="headerlink" title="3.1.蓝牙地址"></a>3.1.蓝牙地址</h3><p>蓝牙设备编码采取小端模式，即高位在后面。它的前 24 位是制造商分配的产品编号（<strong>LAP</strong>，低地址部分），中间8 位是 SIG 给制造商分配的编号（<strong>UAP</strong>，高地址部分），最后 16 位保留无效（<strong>NAP</strong>，无效地址部分）。</p>
<p><img src="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270004.png" alt=""></p>
<h3 id="3-2-蓝牙时钟"><a href="#3-2-蓝牙时钟" class="headerlink" title="3.2.蓝牙时钟"></a>3.2.蓝牙时钟</h3><p>每个蓝牙设备都有一个独立运行的内部系统时钟，称为本地时钟（Local Clock），决定定时器的收发跳频。为了与其他设备同步，本地时钟要加一个偏移量（offset），提供给其他设备同步。 具体说来，蓝牙系统中的时钟分为以下几种：</p>
<ul>
<li><strong>CLKN：</strong>本地时钟：</li>
<li><strong>CLKE：</strong>预计时钟，扫描寻呼过程中用到；</li>
<li><strong>CLK：</strong>设备实际运行的时钟。</li>
</ul>
<p>这三者之间存在着相关关系，具体说来 <strong>CLKE</strong>、<strong>CLK</strong> 由 <strong>CLKN</strong> 加上一个偏移量得到的。</p>
<ul>
<li><strong>主设备</strong>：<strong>CLK = CLKN</strong></li>
<li><p><strong>从设备</strong>：<strong>CLK = CLKN + offset</strong></p>
<h3 id="3-3-蓝牙物理链路"><a href="#3-3-蓝牙物理链路" class="headerlink" title="3.3.蓝牙物理链路"></a>3.3.蓝牙物理链路</h3></li>
</ul>
<p>通信设备间物理层的数据连接通道就是物理链路。</p>
<ul>
<li><strong>ACL</strong>（A<strong>synchronous Connectionless</strong>）异步无连接链路；对时间要求不敏感的数据通信，如文件数据、控制信令等。</li>
<li><strong>SCO</strong>（<strong>Synochronous Connection Oriented</strong>）同步面向连接链路；对时间比较敏感的通信，如：语音；最多只支持3条 <strong>SCO</strong> 链路，不支持重传。</li>
</ul>
<h3 id="3-4-蓝牙基带分组"><a href="#3-4-蓝牙基带分组" class="headerlink" title="3.4.蓝牙基带分组"></a>3.4.蓝牙基带分组</h3><p><img src="https://raw.githubusercontent.com/JackSmithThu/MarkdownPhotos/master/201707270005.png" alt=""></p>
<p>基带分组至少包括：接入码、分组头、有效载荷；</p>
<ul>
<li><strong>接入码</strong>用于同步、直流、载频泄漏偏置补偿标识；</li>
<li><strong>分组头</strong>包含链路信息，确保纠正较多的错误。</li>
</ul>
<p>详细分组类型如下：</p>
<table>
<thead>
<tr>
<th>分组类别</th>
<th>Type (b3b2b1b0)</th>
<th>时隙</th>
<th>SCO</th>
<th>ACL</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>链路控制分组</strong></td>
<td>0000</td>
<td>1</td>
<td>NULL</td>
<td>NULL</td>
</tr>
<tr>
<td></td>
<td>0001</td>
<td></td>
<td>POLL</td>
<td>POLL</td>
</tr>
<tr>
<td></td>
<td>0010</td>
<td></td>
<td>FHS</td>
<td>FHS</td>
</tr>
<tr>
<td></td>
<td>0011</td>
<td></td>
<td>DM1</td>
<td>DM1</td>
</tr>
<tr>
<td><strong>单时隙分组</strong></td>
<td>0100</td>
<td>1</td>
<td>未定义</td>
<td>NULL</td>
</tr>
<tr>
<td></td>
<td>0101</td>
<td></td>
<td>HV1</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0110</td>
<td></td>
<td>HV2</td>
<td></td>
</tr>
<tr>
<td></td>
<td>0111</td>
<td></td>
<td>HV3</td>
<td></td>
</tr>
<tr>
<td></td>
<td>1000</td>
<td></td>
<td>DV</td>
<td></td>
</tr>
<tr>
<td></td>
<td>1001</td>
<td></td>
<td>NULL</td>
<td>AUX1</td>
</tr>
<tr>
<td><strong>三时隙分组</strong></td>
<td>1010</td>
<td>3</td>
<td>未定义</td>
<td>DM3</td>
</tr>
<tr>
<td></td>
<td>1011</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>1100</td>
<td></td>
<td></td>
<td>未定义</td>
</tr>
<tr>
<td></td>
<td>1101</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>五时隙分组</strong></td>
<td>1110</td>
<td>5</td>
<td>未定义</td>
<td>DM5</td>
</tr>
<tr>
<td></td>
<td>1111</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li><p><strong>ACL分组形式为：D(M|H)（1|3|5）,D</strong>代表数据分组，<strong>M</strong>代表用<strong>2/3</strong>比例的 <strong>FEC</strong> 的中等速率分组；<strong>H</strong> 代表不使用纠错码的高速率分组；<strong>1、3、5</strong>分别代表分组所占用的时隙数目；</p>
<p>​DM1、DM3、DM5、DH1、DH3、DH5</p>
</li>
<li><p><strong>SCO分组形式为：HV(1|2|3)。HV</strong>代表高质量语言分组，<strong>1、2、3</strong> 有效载荷所采用的纠错码方法。<strong>1</strong>为<strong>1/3</strong>比例 <strong>FEC</strong>，设备<strong>2</strong>个时隙发送一个单时隙分组；<strong>2</strong> 为 <strong>2/3</strong> 比例 <strong>FEC</strong> ，设备<strong>4</strong>个时隙发送一个单时隙分组；<strong>3</strong>为不使用纠错码，设备<strong>6</strong>个时隙发送一个单时隙分组。</p>
<p>​HV1、HV2、HV3</p>
</li>
</ul>
<h4 id="3-4-1-ACL分组"><a href="#3-4-1-ACL分组" class="headerlink" title="3.4.1.ACL分组"></a>3.4.1.ACL分组</h4><table>
<thead>
<tr>
<th>类型</th>
<th>有效载荷头/字节</th>
<th>用户有效载荷/字节</th>
<th>FEC</th>
<th>CRC</th>
<th>对称最大速率/kbps</th>
<th>非对称速率/kbps</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>前向</td>
<td>后向</td>
</tr>
<tr>
<td>DM1</td>
<td>1</td>
<td>0～17</td>
<td>2/3</td>
<td>有</td>
<td>108.8</td>
<td>108.8</td>
<td>108.8</td>
</tr>
<tr>
<td>DH1</td>
<td>1</td>
<td>0～27</td>
<td>无</td>
<td>有</td>
<td>172.8</td>
<td>172.8</td>
<td>172.8</td>
</tr>
<tr>
<td>DM3</td>
<td>2</td>
<td>0～121</td>
<td>2/3</td>
<td>有</td>
<td>258.1</td>
<td>387.2</td>
<td>54.4</td>
</tr>
<tr>
<td>DH3</td>
<td>2</td>
<td>0～183</td>
<td>无</td>
<td>有</td>
<td>390.4</td>
<td>585.6</td>
<td>86.4</td>
</tr>
<tr>
<td>DM5</td>
<td>2</td>
<td>0～224</td>
<td>2/3</td>
<td>有</td>
<td>286.7</td>
<td>477.8</td>
<td>36.3</td>
</tr>
<tr>
<td>MH5</td>
<td>2</td>
<td>0～339</td>
<td>无</td>
<td>有</td>
<td>433.9</td>
<td>723.2</td>
<td>57.6</td>
</tr>
<tr>
<td>AUX1</td>
<td>1</td>
<td>0～29</td>
<td>无</td>
<td>无</td>
<td>185.6</td>
<td>185.6</td>
<td>185.6</td>
</tr>
</tbody>
</table>
<h3 id="3-4-2-SCO分组"><a href="#3-4-2-SCO分组" class="headerlink" title="3.4.2.SCO分组"></a>3.4.2.SCO分组</h3><table>
<thead>
<tr>
<th>类型</th>
<th>有效载荷头/字节</th>
<th>用户有效载荷/字节</th>
<th>FEC</th>
<th>CRC</th>
<th>有效载荷长度</th>
<th>同步速率/kbps</th>
<th>占用Tsco数目/语言长度</th>
</tr>
</thead>
<tbody>
<tr>
<td>HV1</td>
<td>无</td>
<td>10</td>
<td>1/3</td>
<td></td>
<td>240位</td>
<td>64</td>
<td>2/1.25ms</td>
</tr>
<tr>
<td>HV2</td>
<td></td>
<td>20</td>
<td>2/3</td>
<td></td>
<td></td>
<td></td>
<td>4/2.5ms</td>
</tr>
<tr>
<td>HV3</td>
<td></td>
<td>30</td>
<td>无</td>
<td></td>
<td></td>
<td></td>
<td>6/3.75ms</td>
</tr>
<tr>
<td>6/3.75ms</td>
<td>1D</td>
<td>10+(0-9)D</td>
<td>2/3D</td>
<td>有D</td>
<td></td>
<td>64+57.6D</td>
</tr>
</tbody>
</table>
<p>注释：<strong>D</strong> 表示只对数据段有用，<strong>DV</strong> 表示分组包含数据段，也包含语言段。</p>
<h2 id="X-参考链接"><a href="#X-参考链接" class="headerlink" title="X.参考链接"></a>X.参考链接</h2><p><a href="http://blog.csdn.net/xubin341719/article/details/38303881" target="_blank" rel="external">蓝牙核心技术概述（三）： 蓝牙协议规范（射频、基带链路控制、链路管理）</a></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/蓝牙/">蓝牙</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2017/06/25/Spring中bean的作用域/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          Spring中bean的作用域
        
      </div>
    </a>
  
  
    <a href="/2017/06/25/Eclipse搭建SpringBoot（四）使用LogBack/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Eclipse搭建SpringBoot（四）使用LogBack&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>




<div class="share_addthis">
  <div class="sharing addthis_toolbox share">
    <a class="addthis_button_facebook_like"></a>
    <a class="addthis_button_tweet"></a>
    <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-560c64c35486b3d4" async="async"></script>
</div>





</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Jack Smith&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>
  </div><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>